import{_ as z,r as v,q as x,w as O,c as u,o as r,a as d,f,F as T,g as L,t as w,h as R,k as G,C as _,l as p,n as b,d as D}from"./main-B0o3yjtm.js";const H={class:"meal-notes-wrapper"},J={key:0,class:"chips-container"},P={class:"chip-text"},Q=["onClick"],W={class:"input-container"},X=["onKeydown"],Y={key:0,class:"dropdown"},Z=["onMousedown","onMouseenter"],ee={key:0,class:"use-count"},te={__name:"MealNotesInput",props:{presetNotes:{type:Array,default:()=>[]},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(S,{emit:V}){const y=S,B=V,m=v(""),a=v([]),c=v(!1),s=v(-1),C=v(null),l=x(()=>m.value.trim()),i=x(()=>{const t=y.presetNotes.map(n=>({noteID:n.recID,noteText:n.notes}));if(!l.value)return t.slice(0,15);const e=l.value.toLowerCase();return t.filter(n=>n.noteText.toLowerCase().includes(e)).slice(0,15)}),h=x(()=>{if(!l.value)return!1;const t=i.value.some(o=>o.noteText.toLowerCase()===l.value.toLowerCase()),e=a.value.some(o=>o.toLowerCase()===l.value.toLowerCase());return!t&&!e}),A=()=>{c.value=!0},E=()=>{setTimeout(()=>{c.value=!1,s.value=-1},200)},F=()=>{c.value=!0,s.value=-1},$=()=>{s.value>=0?s.value<i.value.length?N(i.value[s.value].noteText):h.value&&g():l.value&&g()},K=()=>{const t=i.value.length+(h.value?1:0)-1;s.value<t&&s.value++},q=()=>{s.value>0&&s.value--},U=()=>{c.value=!1,s.value=-1},N=t=>{I(t)},g=()=>{l.value&&I(l.value)},I=t=>{const e=t.trim();!a.value.some(n=>n.toLowerCase()===e.toLowerCase())&&e&&(a.value.push(e),k()),m.value="",s.value=-1,C.value?.focus()},j=t=>{a.value.splice(t,1),k()},k=()=>{const t=a.value.join(", ");B("update:modelValue",t)};return O(()=>y.modelValue,t=>{t?a.value=t.split(",").map(e=>e.trim()).filter(e=>e):a.value=[]},{immediate:!0}),(t,e)=>(r(),u("div",H,[e[3]||(e[3]=d("label",{class:"notes-label"},"Add note (e.g., No Onion, Less Salt…)",-1)),a.value.length>0?(r(),u("div",J,[(r(!0),u(T,null,L(a.value,(o,n)=>(r(),u("div",{key:n,class:"chip"},[d("span",P,w(o),1),d("button",{type:"button",class:"chip-remove",onClick:M=>j(n),"aria-label":"Remove note"}," ❌ ",8,Q)]))),128))])):f("",!0),d("div",W,[R(d("input",{ref_key:"inputElement",ref:C,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),type:"text",class:"notes-input",placeholder:"Type to search or add a note...",onFocus:A,onBlur:E,onInput:F,onKeydown:[_(p($,["prevent"]),["enter"]),_(p(K,["prevent"]),["down"]),_(p(q,["prevent"]),["up"]),_(U,["esc"])]},null,40,X),[[G,m.value]]),c.value&&(i.value.length>0||h.value)?(r(),u("div",Y,[(r(!0),u(T,null,L(i.value,(o,n)=>(r(),u("button",{key:o.noteID,type:"button",class:b(["dropdown-item",{highlighted:s.value===n}]),onMousedown:p(M=>N(o.noteText),["prevent"]),onMouseenter:M=>s.value=n},[D(w(o.noteText)+" ",1),o.useCount>1?(r(),u("span",ee,w(o.useCount)+"×",1)):f("",!0)],42,Z))),128)),h.value?(r(),u("button",{key:0,type:"button",class:b(["dropdown-item add-new",{highlighted:s.value===i.value.length}]),onMousedown:p(g,["prevent"]),onMouseenter:e[1]||(e[1]=o=>s.value=i.value.length)},[e[2]||(e[2]=d("span",{class:"add-icon"},"➕",-1)),D(' Add "'+w(l.value)+'" ',1)],34)):f("",!0)])):f("",!0)])]))}},se=z(te,[["__scopeId","data-v-9e83e230"]]);export{se as M};
