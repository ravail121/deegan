import{_ as T,x as $,y as S,r as y,l as F,c as o,a as e,f as c,e as I,p as n,F as f,g as b,t as r,k as M,z as O,A as R,o as l}from"./main-h-jISMfU.js";import{u as A}from"./cart-DJYkgXy0.js";const B={class:"wrap"},P={class:"topbar"},V={key:0,class:"list"},E=["src","alt"],N={class:"info"},j={class:"top"},q={class:"name"},Y={class:"qtybox"},z=["disabled","onClick"],L=["onClick"],W={class:"meta"},G={key:0},H=["onClick"],K={key:1,class:"empty"},Q={key:2,class:"summary"},U={class:"row"},J={key:0,class:"row"},X={key:1,class:"row"},Z={class:"row total"},ee=["disabled"],se={key:3,class:"order-loader-overlay"},te={key:4,class:"success-modal-overlay"},oe={class:"success-modal"},le={key:0},ae={class:"modal"},ne={class:"actions"},re={__name:"Checkout",setup(ie){const _=R(),a=A(),u=$(),p=S(),d=y(null),v=y(!1),g=y(!1),h=y(null);F(async()=>{u.lastFetched||await u.fetchSettings()});function w(i){d.value=i}function C(){d.value!==null&&a.remove(d.value),d.value=null}function D(){g.value=!1,_.push("/")}async function x(){if(!p.hasTableData){alert("Please scan a table QR code first");return}if(a.items.length===0){alert("Your cart is empty");return}v.value=!0;try{const i={items:a.items.map(t=>({itemID:t.id,quantity:t.qty,notes:t.notes||""})),tableName:p.getTableName,tableID:p.getTableID,whouseID:p.getWhouseID},s=await O.post("/api/orders",i);if(s.data.success)h.value=s.data.data,a.clearCart(),g.value=!0;else throw new Error(s.data.message||"Failed to place order")}catch(i){console.error("Order placement failed:",i),alert(`Failed to place order: ${i.response?.data?.message||i.message}`)}finally{v.value=!1}}return(i,s)=>(l(),o("div",B,[e("header",P,[e("button",{class:"iconbtn",onClick:s[0]||(s[0]=t=>i.$router.back()),"aria-label":"Back"},[...s[3]||(s[3]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M15 18l-6-6 6-6","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),s[4]||(s[4]=e("div",{class:"brand"},[e("img",{src:I,alt:"",class:"logo"}),e("span",null,"Deegaan Restaurant")],-1)),s[5]||(s[5]=e("span",{class:"spacer"},null,-1))]),s[17]||(s[17]=e("h1",{class:"title"},"CHECKOUT",-1)),n(a).items.length?(l(),o("main",V,[(l(!0),o(f,null,b(n(a).items,(t,k)=>(l(),o("article",{key:k,class:"line"},[e("img",{src:t.image||"/images/dishes/fish.jpg",class:"thumb",alt:t.name},null,8,E),e("div",N,[e("div",j,[e("h3",q,r(t.name),1),e("div",Y,[e("button",{disabled:t.qty===1,onClick:m=>n(a).dec(k)},"−",8,z),e("span",null,"x"+r(t.qty),1),e("button",{onClick:m=>n(a).inc(k)},"+",8,L)])]),e("ul",W,[t.variant?(l(),o("li",G,"Size: "+r(t.variant.sizeName)+" ($"+r(Number(t.variant.price).toFixed(2))+")",1)):c("",!0),(l(!0),o(f,null,b(t.addOns||[],m=>(l(),o("li",{key:m.id},"+ "+r(m.name),1))),128))]),e("button",{class:"trash","aria-label":"Remove item",onClick:m=>w(k)},[...s[6]||(s[6]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6M10 6V4h4v2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,H)])]))),128))])):(l(),o("p",K,"Your cart is empty.")),n(a).items.length?(l(),o("section",Q,[e("div",U,[s[7]||(s[7]=e("span",null,"Subtotal:",-1)),e("strong",null,"$"+r(n(a).total.toFixed(2)),1)]),parseFloat(n(u).getVATPercentage)>0?(l(),o("div",J,[e("span",null,r(n(u).getVATDisplayText)+":",1),e("strong",null,"$"+r(n(u).calculateVAT(n(a).total).toFixed(2)),1)])):(l(),o("div",X,[...s[8]||(s[8]=[e("span",null,"Tax:",-1),e("strong",null,"$0.00",-1)])])),e("div",Z,[s[9]||(s[9]=e("span",null,"Total:",-1)),e("strong",null,"$"+r(n(u).calculateTotalWithVAT(n(a).total).toFixed(2)),1)]),s[10]||(s[10]=e("p",{class:"delivery"},"Estimated delivery: 25–30 min",-1)),e("button",{class:"orderbtn",onClick:x,disabled:v.value},r(v.value?"PLACING ORDER...":"PLACE ORDER"),9,ee)])):c("",!0),v.value?(l(),o("div",se,[...s[11]||(s[11]=[e("div",{class:"order-loader"},[e("div",{class:"loader-spinner"}),e("h3",null,"Placing Your Order..."),e("p",null,"Please wait while we process your order and create all necessary records.")],-1)])])):c("",!0),g.value?(l(),o("div",te,[e("div",oe,[s[12]||(s[12]=e("div",{class:"success-icon"},[e("svg",{viewBox:"0 0 24 24",width:"48",height:"48",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 12l2 2 4-4","stroke-linecap":"round","stroke-linejoin":"round"}),e("circle",{cx:"12",cy:"12",r:"10","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),s[13]||(s[13]=e("h3",null,"Order Placed Successfully!",-1)),h.value?(l(),o("p",le,"Order ID: "+r(h.value.orderID),1)):c("",!0),s[14]||(s[14]=e("p",null,"Your order has been received and is being prepared.",-1)),e("button",{class:"back-to-menu-btn",onClick:D},"Back to Menu")])])):c("",!0),d.value!==null?(l(),o("div",{key:5,class:"overlay",onClick:s[2]||(s[2]=M(t=>d.value=null,["self"]))},[e("div",ae,[s[15]||(s[15]=e("h3",{class:"confirm-title"},"Remove this item?",-1)),s[16]||(s[16]=e("p",{class:"confirm-text"},"Are you sure you want to remove it from your cart?",-1)),e("div",ne,[e("button",{class:"cancel",onClick:s[1]||(s[1]=t=>d.value=null)},"Cancel"),e("button",{class:"danger",onClick:C},"Delete")])])])):c("",!0)]))}},ce=T(re,[["__scopeId","data-v-c689676a"]]);export{ce as default};
