import{_ as B,u as E,y as F,z as O,r as k,q as A,p as R,c as o,a as e,f as v,e as P,s as i,F as N,g as D,t as a,l as M,j,A as q,B as L,o as l,d as z}from"./main-B0o3yjtm.js";import{M as Y}from"./MealNotesInput-De0w6c7Y.js";const H={class:"wrap"},U={class:"topbar"},W={key:0,class:"list"},G=["src","alt"],K={class:"info"},Q={class:"top"},J={class:"name"},X={class:"qtybox"},Z=["disabled","onClick"],ee=["onClick"],te={class:"meta"},se={key:0},oe={key:1,class:"notes"},le=["onClick"],ne={key:2,class:"add-note"},ae=["onClick"],re=["onClick"],ie={key:1,class:"empty"},de={key:2,class:"summary"},ue={class:"row"},ce={key:0,class:"row"},ve={key:1,class:"row"},me={class:"row total"},pe=["disabled"],ke={key:3,class:"order-loader-overlay"},he={key:4,class:"success-modal-overlay"},be={class:"success-modal"},fe={key:0},ge={class:"modal"},ye={class:"actions"},Ce={class:"edit-notes-modal"},_e={class:"modal-subtitle"},we={__name:"Checkout",setup(Ne){const x=L(),n=E(),m=F(),f=O(),d=k(null),h=k(!1),y=k(!1),C=k(null),u=k(null),b=k(""),_=A(()=>u.value!==null?n.items[u.value]:null);R(async()=>{m.lastFetched||await m.fetchSettings()});function T(r){d.value=r}function $(){d.value!==null&&n.remove(d.value),d.value=null}function I(){y.value=!1,x.push("/")}function w(r){u.value=r,b.value=n.items[r].notes||""}function g(){u.value=null,b.value=""}function S(){u.value!==null&&(n.updateNotes(u.value,b.value),g())}async function V(){if(!f.hasTableData){alert("Please scan a table QR code first");return}if(n.items.length===0){alert("Your cart is empty");return}h.value=!0;try{const r={items:n.items.map(s=>({itemID:s.id,quantity:s.qty,notes:s.notes||""})),tableName:f.getTableName,tableID:f.getTableID,whouseID:f.getWhouseID},t=await q.post("/api/orders",r);if(t.data.success)C.value=t.data.data,n.clearCart(),y.value=!0;else throw new Error(t.data.message||"Failed to place order")}catch(r){console.error("Order placement failed:",r),alert(`Failed to place order: ${r.response?.data?.message||r.message}`)}finally{h.value=!1}}return(r,t)=>(l(),o("div",H,[e("header",U,[e("button",{class:"iconbtn",onClick:t[0]||(t[0]=s=>r.$router.back()),"aria-label":"Back"},[...t[4]||(t[4]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M15 18l-6-6 6-6","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),t[5]||(t[5]=e("div",{class:"brand"},[e("img",{src:P,alt:"",class:"logo"}),e("span",null,"Deegaan Restaurant")],-1)),t[6]||(t[6]=e("span",{class:"spacer"},null,-1))]),t[21]||(t[21]=e("h1",{class:"title"},"CHECKOUT",-1)),i(n).items.length?(l(),o("main",W,[(l(!0),o(N,null,D(i(n).items,(s,p)=>(l(),o("article",{key:p,class:"line"},[e("img",{src:s.image||"/images/dishes/fish.jpg",class:"thumb",alt:s.name},null,8,G),e("div",K,[e("div",Q,[e("h3",J,a(s.name),1),e("div",X,[e("button",{disabled:s.qty===1,onClick:c=>i(n).dec(p)},"−",8,Z),e("span",null,"x"+a(s.qty),1),e("button",{onClick:c=>i(n).inc(p)},"+",8,ee)])]),e("ul",te,[s.variant?(l(),o("li",se,"Size: "+a(s.variant.sizeName)+" ($"+a(Number(s.variant.price).toFixed(2))+")",1)):v("",!0),(l(!0),o(N,null,D(s.addOns||[],c=>(l(),o("li",{key:c.id},"+ "+a(c.name),1))),128)),s.notes?(l(),o("li",oe,[z(" Note: "+a(s.notes)+" ",1),e("button",{class:"edit-note-btn",onClick:c=>w(p),"aria-label":"Edit notes"},[...t[7]||(t[7]=[e("svg",{viewBox:"0 0 24 24",width:"14",height:"14",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,le)])):(l(),o("li",ne,[e("button",{class:"add-note-btn",onClick:c=>w(p)}," ➕ Add note ",8,ae)]))]),e("button",{class:"trash","aria-label":"Remove item",onClick:c=>T(p)},[...t[8]||(t[8]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6M10 6V4h4v2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,re)])]))),128))])):(l(),o("p",ie,"Your cart is empty.")),i(n).items.length?(l(),o("section",de,[e("div",ue,[t[9]||(t[9]=e("span",null,"Subtotal:",-1)),e("strong",null,"$"+a(i(n).total.toFixed(2)),1)]),parseFloat(i(m).getVATPercentage)>0?(l(),o("div",ce,[e("span",null,a(i(m).getVATDisplayText)+":",1),e("strong",null,"$"+a(i(m).calculateVAT(i(n).total).toFixed(2)),1)])):(l(),o("div",ve,[...t[10]||(t[10]=[e("span",null,"Tax:",-1),e("strong",null,"$0.00",-1)])])),e("div",me,[t[11]||(t[11]=e("span",null,"Total:",-1)),e("strong",null,"$"+a(i(m).calculateTotalWithVAT(i(n).total).toFixed(2)),1)]),t[12]||(t[12]=e("p",{class:"delivery"},"Estimated delivery: 25–30 min",-1)),e("button",{class:"orderbtn",onClick:V,disabled:h.value},a(h.value?"PLACING ORDER...":"PLACE ORDER"),9,pe)])):v("",!0),h.value?(l(),o("div",ke,[...t[13]||(t[13]=[e("div",{class:"order-loader"},[e("div",{class:"loader-spinner"}),e("h3",null,"Placing Your Order..."),e("p",null,"Please wait while we process your order and create all necessary records.")],-1)])])):v("",!0),y.value?(l(),o("div",he,[e("div",be,[t[14]||(t[14]=e("div",{class:"success-icon"},[e("svg",{viewBox:"0 0 24 24",width:"48",height:"48",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 12l2 2 4-4","stroke-linecap":"round","stroke-linejoin":"round"}),e("circle",{cx:"12",cy:"12",r:"10","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),t[15]||(t[15]=e("h3",null,"Order Placed Successfully!",-1)),C.value?(l(),o("p",fe,"Order ID: "+a(C.value.orderID),1)):v("",!0),t[16]||(t[16]=e("p",null,"Your order has been received and is being prepared.",-1)),e("button",{class:"back-to-menu-btn",onClick:I},"Back to Menu")])])):v("",!0),d.value!==null?(l(),o("div",{key:5,class:"overlay",onClick:t[2]||(t[2]=M(s=>d.value=null,["self"]))},[e("div",ge,[t[17]||(t[17]=e("h3",{class:"confirm-title"},"Remove this item?",-1)),t[18]||(t[18]=e("p",{class:"confirm-text"},"Are you sure you want to remove it from your cart?",-1)),e("div",ye,[e("button",{class:"cancel",onClick:t[1]||(t[1]=s=>d.value=null)},"Cancel"),e("button",{class:"danger",onClick:$},"Delete")])])])):v("",!0),u.value!==null?(l(),o("div",{key:6,class:"overlay",onClick:M(g,["self"])},[e("div",Ce,[e("div",{class:"modal-header"},[t[20]||(t[20]=e("h3",{class:"modal-title"},"Edit Notes",-1)),e("button",{class:"close-btn",onClick:g,"aria-label":"Close"},[...t[19]||(t[19]=[e("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)])])]),e("p",_e,a(_.value?.name),1),j(Y,{"preset-notes":_.value?.presetNotes||[],modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=s=>b.value=s)},null,8,["preset-notes","modelValue"]),e("div",{class:"modal-actions"},[e("button",{class:"cancel",onClick:g},"Cancel"),e("button",{class:"confirm",onClick:S},"Save Notes")])])])):v("",!0)]))}},xe=B(we,[["__scopeId","data-v-5f6e50d8"]]);export{xe as default};
